# =============================================================================
# ORCHESTRATOR MANIFEST (shared)
# =============================================================================
# Central registry of agents, pipeline patterns, and complexity signals.
# This file is tracked by git and shared across all users.
#
# User-specific configuration (projects, library experts) lives in:
#   ~/.dev-env/orchestrator/manifest.local.yaml  (gitignored)
#
# The orchestrator loads BOTH files:
#   @~/.dev-env/orchestrator/manifest.yaml        (this file -- shared)
#   @~/.dev-env/orchestrator/manifest.local.yaml  (your local setup)
# =============================================================================

# -----------------------------------------------------------------------------
# PROJECT PORTFOLIO & LIBRARY EXPERTS
# -----------------------------------------------------------------------------
# These are user-specific and live in manifest.local.yaml (gitignored).
# Each user has their own projects and library experts with different
# repo paths, stacks, and source code locations.
#
# To add a project or library expert, edit manifest.local.yaml or ask:
#   "Add ~/Work/projects/my-project to the manifest"
#   "Create a library expert for shared-utils at ~/Work/projects/shared-utils"
#
# See manifest.local.yaml for format examples.
# -----------------------------------------------------------------------------

# -----------------------------------------------------------------------------
# AGENT REGISTRY
# -----------------------------------------------------------------------------
# Lists all available agents with their capabilities.
# The orchestrator uses this for intent matching and pipeline planning.
# Agent definitions (full system prompts) live in ~/.dev-env/agents/
# Skills are scoped per agent and live in ~/.dev-env/skills/{agent-name}/
# -----------------------------------------------------------------------------
agents:
  - name: codebase-intelligence
    type: knowledge
    handles:
      - explore and understand existing code
      - explain how a feature works
      - analyze architecture and design patterns
      - trace data/control flow across files and services
      - pre-implementation research on unfamiliar code
      - onboard to a new area of the codebase
    skills_dir: ~/.dev-env/skills/codebase-intelligence/
    skills:
      - exploration # workflow: structured codebase exploration
      - summarization # format: concise summaries for pipeline agents
      - dependency-tracing # workflow: trace data/control flow and dependencies

  - name: planning
    type: strategy
    handles:
      - break down complex features into ordered implementation steps
      - create detailed implementation plans with file-level specificity
      - identify risks, edge cases, and decisions needing user input
      - sprint-level task breakdown for epics
      - sequence multi-step changes across files and modules
    skills_dir: ~/.dev-env/skills/planning/
    skills:
      - task-breakdown # workflow: decompose tasks into ordered steps
      - risk-identification # checklist: identify risks and decisions before implementation
      - file-change-mapping # workflow: map files to create, modify, or delete

  - name: implementation
    type: execution
    handles:
      - write new code (components, endpoints, scripts, functions)
      - refactor existing code for better patterns
      - add features to existing modules
      - fix bugs after diagnosis
      - write/update unit and integration tests
      - database schema changes and migrations
      - state management work (Redux, Zustand, etc.)
      - integrate with external services/APIs
    skills_dir: ~/.dev-env/skills/implementation/
    skills:
      - react-patterns # patterns: modern React/TypeScript best practices
      - nestjs-patterns # patterns: NestJS framework conventions
      - python-patterns # patterns: PEP 8 and modern Python
      - testing-patterns # patterns: unit, integration, and component testing
      - code-quality # checklist: clean, maintainable production code

  - name: code-review
    type: quality
    handles:
      - review code quality, readability, and maintainability
      - check for security vulnerabilities
      - identify performance issues
      - verify best practice adherence
      - review PRs from teammates
      - self-review before pushing
    skills_dir: ~/.dev-env/skills/code-review/
    skills:
      - review-checklist # checklist: systematic multi-pass review framework
      - pr-review-format # format: constructive and actionable review feedback

  - name: debugging
    type: diagnosis
    handles:
      - diagnose frontend bugs (UI, state, rendering)
      - diagnose backend bugs (API errors, DB queries)
      - trace cross-service issues (frontend -> API -> data)
      - analyze error logs and monitoring alerts
      - identify root cause of failing tests
    skills_dir: ~/.dev-env/skills/debugging/
    skills:
      - diagnostic-workflow # workflow: hypothesis-driven diagnosis process
      - log-analysis # workflow: interpret error logs and stack traces
      - cross-service-tracing # workflow: trace bugs across service boundaries

  - name: infrastructure
    type: devops
    handles:
      - Docker and containerization
      - CI/CD pipeline configuration
      - deployment scripts
      - environment configuration and secrets management
    skills_dir: ~/.dev-env/skills/infrastructure/
    skills:
      - docker-patterns # patterns: production-quality Docker configs
      - ci-cd-patterns # patterns: reliable CI/CD pipelines
      - deployment-patterns # patterns: deployment scripts and release management

  - name: docs-and-contracts
    type: documentation
    handles:
      - document API contracts and endpoints
      - sync shared types/interfaces across repos
      - write technical design documents
      - update README and developer guides
    skills_dir: ~/.dev-env/skills/docs-and-contracts/
    skills:
      - api-contract-format # format: clear API contract documentation
      - type-sync-patterns # patterns: cross-repo TypeScript type sync

  - name: git-conflict-resolver
    type: resolution
    handles:
      - resolve git merge conflicts
      - resolve git rebase conflicts
      - analyze conflict markers and determine resolution strategy
      - semantic merge of conflicting code changes
      - post-merge verification of resolved files
    skills_dir: ~/.dev-env/skills/git-conflict-resolver/
    skills:
      - conflict-analysis # workflow: parse and categorize conflict blocks
      - conflict-pattern-recognition # patterns: common patterns with reliable resolutions
      - semantic-merge # workflow: intent-aware merge logic
      - dependency-chain-resolution # workflow: trace cross-file conflict dependencies
      - post-merge-verification # checklist: verify merged result correctness

  - name: git-champ
    type: operations
    handles:
      - commit with smart commit messages (analyze changes, draft message, confirm)
      - push, pull, fetch, sync with remote
      - branch management (create, switch, delete, rename, track)
      - stash and unstash work-in-progress
      - undo commits (soft reset, hard reset, revert)
      - create pull requests via gh CLI
      - review and merge pull requests
      - rebase and cherry-pick operations
      - view history, diffs, blame, bisect
      - manage GitHub issues, releases, and workflow runs
      - diagnose and explain git/gh errors
    skills_dir: ~/.dev-env/skills/git-champ/
    skills:
      - smart-commits # workflow: analyze changes and draft commit messages
      - branch-management # patterns: branch operations and workflows
      - pull-requests # workflow: create and manage PRs via gh CLI
      - rebase-and-merge # patterns: advanced history operations
      - stash-and-undo # patterns: safe stash and undo operations
      - history-and-inspection # patterns: navigate history, diffs, blame
      - gh-workflows # patterns: GitHub issues, releases, actions via gh
      - error-diagnosis # workflow: diagnose and fix git/gh errors

  - name: config-master
    type: meta
    handles:
      - add, update, or remove projects in the manifest
      - create new agent definitions
      - create new library expert instances from template
      - author or update skill files for any agent
      - modify orchestrator rules and pipeline patterns
      - run setup-project.sh for new repos
      - any maintenance of the ~/.dev-env/ infrastructure
    skills_dir: null # config-master doesn't need skills -- it IS the skills manager

# -----------------------------------------------------------------------------
# PIPELINE PATTERNS
# -----------------------------------------------------------------------------
# Predefined agent sequences for common task types.
# The orchestrator uses these as templates but can dynamically
# skip steps for simple tasks or add steps for complex ones.
# -----------------------------------------------------------------------------
pipeline_patterns:
  # Simple tasks -- single agent or orchestrator handles directly
  trivial_question:
    description: "Simple question answerable from memory or current context"
    pipeline: [] # orchestrator handles directly
    examples:
      - "What did we work on yesterday?"
      - "What's the project tech stack?"

  quick_fix:
    description: "Single-file change with obvious fix"
    pipeline: [implementation]
    examples:
      - "Fix the typo in the header component"
      - "Rename this variable to camelCase"

  # Standard tasks -- 2-3 agents
  exploration:
    description: "Understand existing code without making changes"
    pipeline: [codebase-intelligence]
    examples:
      - "How does the auth flow work?"
      - "What components use the DateRangePicker?"

  standard_feature:
    description: "Feature implementation in a single repo"
    pipeline: [codebase-intelligence, planning, implementation]
    examples:
      - "Add pagination to the users endpoint"
      - "Add bulk delete functionality to entries"

  standard_bugfix:
    description: "Bug requiring diagnosis then fix"
    pipeline: [debugging, implementation]
    examples:
      - "Users can't export CSV anymore"
      - "The login form doesn't validate email format"

  library_consumption:
    description: "Implement a component/feature from an internal library"
    pipeline: ["{library-expert}", implementation]
    examples:
      - "Implement Venus DateRangePicker in the filter panel"
      - "Add a stacked bar chart using cs-highcharts"

  # Complex tasks -- full pipeline
  complex_feature:
    description: "Multi-file feature, architecture change, or new system"
    pipeline: [codebase-intelligence, planning, implementation, code-review]
    examples:
      - "Build the new analytics dashboard with 5 chart types"
      - "Migrate from Redux to Zustand"

  cross_repo_feature:
    description: "Changes spanning multiple repositories"
    pipeline: [codebase-intelligence, codebase-intelligence, planning, implementation, implementation]
    notes: "codebase-intelligence runs on each repo, implementation runs on each repo"
    examples:
      - "Update the user API contract and frontend consumer"
      - "Add a new field to the data pipeline and expose in API and frontend"

  library_contribution:
    description: "Making changes to a library's source code"
    pipeline: ["{library-expert}", planning, implementation]
    examples:
      - "Add timezone support to Venus DateRangePicker"
      - "Add stacking feature to cs-highcharts"

  code_review_task:
    description: "Review code or PR"
    pipeline: [code-review]
    fallback_pipeline: [codebase-intelligence, code-review]
    notes: "Use fallback when reviewing unfamiliar code"
    examples:
      - "Review my changes before I push"
      - "Review this PR from teammate"

  infrastructure_task:
    description: "DevOps, Docker, CI/CD, deployment work"
    pipeline: [infrastructure]
    fallback_pipeline: [codebase-intelligence, infrastructure]
    examples:
      - "Dockerize the Python ETL service"
      - "Set up GitHub Actions for the frontend repo"

  documentation_task:
    description: "API docs, tech design docs, README updates"
    pipeline: [codebase-intelligence, docs-and-contracts]
    examples:
      - "Document the API contract for user service"
      - "Write a tech design doc for the new caching layer"

  git_operations:
    description: "Any git or gh CLI operation -- commits, branches, PRs, stash, undo, history"
    pipeline: [git-champ]
    examples:
      - "Commit my changes"
      - "Create a PR for this branch"
      - "Stash my work and switch to main"
      - "Undo my last commit but keep the changes"
      - "Push to remote"
      - "Show me what changed since yesterday"
      - "Create a release tag"

  git_conflict_resolution:
    description: "Resolve git merge or rebase conflicts"
    pipeline: [git-conflict-resolver]
    fallback_pipeline: [codebase-intelligence, git-conflict-resolver]
    notes: "For simple conflicts, git-conflict-resolver handles directly. For complex conflicts in unfamiliar code, codebase-intelligence provides context first."
    examples:
      - "Resolve the merge conflicts"
      - "Fix the git conflicts from the rebase"
      - "Help me merge this branch"

  # Dev-env management pipelines -- config-master with optional pre-scanning
  dev_env_add_project:
    description: "Adding a new project to the manifest -- auto-scans the repo first"
    pipeline: [codebase-intelligence, config-master]
    notes: "codebase-intelligence scans the project repo to auto-detect stack, structure, and generate summary. config-master uses that context to update manifest and run setup-project.sh"
    examples:
      - "Add ~/Work/projects/argus-frontend to the manifest"
      - "Set up my new project for the orchestrator"

  dev_env_add_library_expert:
    description: "Creating a new library expert -- scans the library source first"
    pipeline: [codebase-intelligence, config-master]
    notes: "codebase-intelligence scans the library source to understand its structure, components, and API surface. config-master creates the agent definition and updates manifest."
    examples:
      - "Create a library expert for shared-utils at ~/Work/projects/shared-utils"
      - "Add a library expert for our design-tokens package"

  dev_env_config_change:
    description: "Direct config changes that don't need scanning -- editing rules, pipelines, existing entries"
    pipeline: [config-master]
    examples:
      - "Update the pipeline for code review tasks"
      - "Change argus-frontend summary in the manifest"
      - "Add a new pipeline pattern for migration tasks"
      - "Create a new migration agent"

  dev_env_author_skill:
    description: "Authoring a new skill file for an agent -- may need to understand the agent's domain first"
    pipeline: [config-master]
    fallback_pipeline: [codebase-intelligence, config-master]
    notes: "For domain-specific skills (e.g., react-patterns), the orchestrator may scan user's actual React code first to tailor the skill to their conventions. For generic skills, config-master handles directly."
    examples:
      - "Write a react-patterns skill for the implementation agent"
      - "Add a new skill for the debugging agent about log analysis"

# -----------------------------------------------------------------------------
# TASK COMPLEXITY SIGNALS
# -----------------------------------------------------------------------------
# Signals the orchestrator uses to classify task complexity
# and decide pipeline depth.
# -----------------------------------------------------------------------------
complexity_signals:
  trivial:
    - "Task requires zero file reads"
    - "Task requires zero code changes"
    - "Simple question answerable from context or memory"
    - "Single-line or single-file obvious fix"
  standard:
    - "Feature in a single repo"
    - "Bug fix with clear symptoms"
    - "Code review of specific changes"
    - "Library component consumption"
  complex:
    - "Multi-file feature spanning modules"
    - "Cross-repo changes (2+ repos involved)"
    - "Architecture changes or migrations"
    - "New system or service creation"
    - "Vague or ambiguous request needing clarification"
    - "Task touches unknown or unfamiliar code"
